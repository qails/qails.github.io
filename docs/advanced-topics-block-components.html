<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Custom Block Components | qails</title><meta name="viewport" content="width=device-width"><link rel="stylesheet" href="/css/qails.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.34.4/es6-shim.min.js"></script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/">qails</a><ul class="nav-site"><li><a href="/docs/overview.html#content" class="active">文档</a></li><li><a href="https://github.com/qailsjs/qails" class="">github</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Quick Start</h3><ul><li><a style="margin-left:0;" class="" href="/docs/overview.html#content">Overview</a></li><li><a style="margin-left:0;" class="" href="/docs/quickstart-api-basics.html#content">API Basics</a></li><li><a style="margin-left:0;" class="" href="/docs/quickstart-rich-styling.html#content">Rich Styling</a></li></ul></div><div class="nav-docs-section"><h3>Advanced Topics</h3><ul><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-entities.html#content">Entities</a></li><li><a style="margin-left:0;" class="" href="/docs/v0-10-api-migration.html#content">v0.10 API Migration</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-decorators.html#content">Decorators</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-key-bindings.html#content">Key Bindings</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-managing-focus.html#content">Managing Focus</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-block-styling.html#content">Block Styling</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-custom-block-render-map.html#content">Custom Block Rendering</a></li><li><a style="margin-left:0;" class="active" href="/docs/advanced-topics-block-components.html#content">Custom Block Components</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-inline-styles.html#content">Complex Inline Styles</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-nested-lists.html#content">Nested Lists</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-text-direction.html#content">Text Direction</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-issues-and-pitfalls.html#content">Issues and Pitfalls</a></li></ul></div><div class="nav-docs-section"><h3>API Reference</h3><ul><li><a style="margin-left:0;" class="" href="/docs/api-reference-editor.html#content">Editor Component</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-editor-change-type.html#content">EditorChangeType</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-editor-state.html#content">EditorState</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-content-state.html#content">ContentState</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-content-block.html#content">ContentBlock</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-character-metadata.html#content">CharacterMetadata</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-entity.html#content">Entity</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-selection-state.html#content">SelectionState</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-composite-decorator.html#content">CompositeDecorator</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-data-conversion.html#content">Data Conversion</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-rich-utils.html#content">RichUtils</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-atomic-block-utils.html#content">AtomicBlockUtils</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-key-binding-util.html#content">KeyBindingUtil</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-modifier.html#content">Modifier</a></li></ul></div></div><div class="inner-content"><a id="content"></a><h1>Custom Block Components</h1><div><p>Draft is designed to solve problems for straightforward rich text interfaces
like comments and chat messages, but it also powers richer editor experiences
like <a href="https://www.facebook.com/notes/" target="_blank">Facebook Notes</a>.</p><p>Users can embed images within their Notes, either loading from their existing
Facebook photos or by uploading new images from the desktop. To that end,
the Draft framework supports custom rendering at the block level, to render
content like rich media in place of plain text.</p><p>The <a href="https://github.com/facebook/draft-js/tree/master/examples/draft-0-10-0/tex" target="_blank">TeX editor</a>
in the Draft repository provides a live example of custom block rendering, with
TeX syntax translated on the fly into editable embedded formula rendering via the
<a href="https://khan.github.io/KaTeX/" target="_blank">KaTeX library</a>.</p><p>A <a href="https://github.com/facebook/draft-js/tree/master/examples/draft-0-10-0/media" target="_blank">media example</a> is also
available, which showcases custom block rendering of audio, image, and video.</p><p>By using a custom block renderer, it is possible to introduce complex rich
interactions within the frame of your editor.</p><h2><a class="anchor" name="custom-block-components"></a>Custom Block Components <a class="hash-link" href="#custom-block-components">#</a></h2><p>Within the <code>Editor</code> component, one may specify the <code>blockRendererFn</code> prop.
This prop function allows a higher-level component to define custom React
rendering for <code>ContentBlock</code> objects, based on block type, text, or other
criteria.</p><p>For instance, we may wish to render <code>ContentBlock</code> objects of type <code>&#x27;atomic&#x27;</code>
using a custom <code>MediaComponent</code>.</p><pre class="prism language-javascript">
<span class="token keyword">function</span> <span class="token function">myBlockRenderer<span class="token punctuation">(</span></span>contentBlock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  const type <span class="token operator">=</span> contentBlock<span class="token punctuation">.</span><span class="token function">getType<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&#x27;atomic&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      component<span class="token punctuation">:</span> MediaComponent<span class="token punctuation">,</span>
      editable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        foo<span class="token punctuation">:</span> <span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">
// Then...
</span>import <span class="token punctuation">{</span>Editor<span class="token punctuation">}</span> from <span class="token string">&#x27;draft-js&#x27;</span><span class="token punctuation">;</span>
class <span class="token class-name">EditorWithMedia</span> extends <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token function">render<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> &lt;Editor <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> blockRendererFn<span class="token operator">=</span><span class="token punctuation">{</span>myBlockRenderer<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><p>If no custom renderer object is returned by the <code>blockRendererFn</code> function,
<code>Editor</code> will render the default <code>DraftEditorBlock</code> text block component.</p><p>The <code>component</code> property defines the component to be used, while the optional
<code>props</code> object includes props that will be passed through to the rendered
custom component via the <code>props.blockProps</code> sub property object. In addition,
the optional <code>editable</code> property determines whether the custom component is
<code>contentEditable</code>.</p><p>It is strongly recommended that you use <code>editable: false</code> if your custom
component will not contain text.</p><p>If your component contains text as provided by your <code>ContentState</code>, your custom
component should compose a <code>DraftEditorBlock</code> component. This will allow the
Draft framework to properly maintain cursor behavior within your contents.</p><p>By defining this function within the context of a higher-level component,
the props for this custom component may be bound to that component, allowing
instance methods for custom component props.</p><h2><a class="anchor" name="defining-custom-block-components"></a>Defining custom block components <a class="hash-link" href="#defining-custom-block-components">#</a></h2><p>Within <code>MediaComponent</code>, the most likely use case is that you will want to
retrieve entity metadata to render your custom block. You may apply an entity
key to the text within a <code>&#x27;atomic&#x27;</code> block during <code>EditorState</code> management,
then retrieve the metadata for that key in your custom component <code>render()</code>
code.</p><pre class="prism language-javascript">
class <span class="token class-name">MediaComponent</span> extends <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    const <span class="token punctuation">{</span>block<span class="token punctuation">,</span> contentState<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    const <span class="token punctuation">{</span>foo<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>blockProps<span class="token punctuation">;</span>
    const data <span class="token operator">=</span> contentState<span class="token punctuation">.</span><span class="token function">getEntity<span class="token punctuation">(</span></span>block<span class="token punctuation">.</span><span class="token function">getEntityAt<span class="token punctuation">(</span></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getData<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment" spellcheck="true"> // Return a &lt;figure&gt; or some other content using this data.
</span>  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><p>The <code>ContentBlock</code> object and the <code>ContentState</code> record are made available
within the custom component, along with the props defined at the top level. By
extracting entity information from the <code>ContentBlock</code> and the <code>Entity</code> map, you
can obtain the metadata required to render your custom component.</p><p><em>Retrieving the entity from the block is admittedly a bit of an awkward API,
and is worth revisiting.</em></p><h2><a class="anchor" name="recommendations-and-other-notes"></a>Recommendations and other notes <a class="hash-link" href="#recommendations-and-other-notes">#</a></h2><p>If your custom block renderer requires mouse interaction, it is often wise
to temporarily set your <code>Editor</code> to <code>readOnly={true}</code> during this
interaction. In this way, the user does not trigger any selection changes within
the editor while interacting with the custom block. This should not be a problem
with respect to editor behavior, since interacting with your custom block
component is most likely mutually exclusive from text changes within the editor.</p><p>The recommendation above is especially important for custom block renderers
that involve text input, like the TeX editor example.</p><p>It is also worth noting that within the Facebook Notes editor, we have not
tried to perform any special SelectionState rendering or management on embedded
media, such as rendering a highlight on an embedded photo when selecting it.
This is in part because of the rich interaction provided on the media
itself, with resize handles and other controls exposed to mouse behavior.</p><p>Since an engineer using Draft has full awareness of the selection state
of the editor and full control over native Selection APIs, it would be possible
to build selection behavior on static embedded media if desired. So far, though,
we have not tried to solve this at Facebook, so we have not packaged solutions
for this use case into the Draft project at this time.</p></div><div class="docs-prevnext"><a class="docs-next" href="advanced-topics-inline-styles.html#content">Next →</a></div></div></section><footer class="wrap"><div class="right">© 2017</div></footer></div><div id="fb-root"></div></body></html>