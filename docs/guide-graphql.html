<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>GraphQL APIs | Qails</title><meta name="viewport" content="width=device-width"><link rel="shortcut icon" href="/images/favicon.png"><link rel="stylesheet" href="/css/qails.css"><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.34.4/es6-shim.min.js"></script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/"><img src="/images/qails-logo-white.png" alt="qails logo">Qails</a><div class="nav-site-wrapper"><ul class="nav-site nav-site-internal"><li><a href="/docs/basic-getting-started.html" class="active" data-target=".nav-docs">文档</a></li></ul><ul class="nav-site nav-site-external"><li><a href="https://github.com/qails" class="">GitHub</a></li><li><a href="https://packingjs.github.io" class="">Packing</a></li></ul></div></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-viewport"><div class="nav-docs-section"><h3>基础知识</h3><ul><li><a style="margin-left:10px;" class="" href="/docs/basic-getting-started.html#content">概述</a></li><li><a style="margin-left:10px;" class="" href="/docs/basic-installation.html#content">安装</a></li><li><a style="margin-left:10px;" class="" href="/docs/basic-structure.html#content">目录结构</a></li><li><a style="margin-left:10px;" class="" href="/docs/basic-commands.html#content">命令</a></li><li><a style="margin-left:10px;" class="" href="/docs/basic-httpd.html#content">HTTP 服务器</a></li><li><a style="margin-left:10px;" class="" href="/docs/basic-middlewares.html#content">内置中间件</a></li><li><a style="margin-left:10px;" class="" href="/docs/basic-util.html#content">内置util方法</a></li></ul></div><div class="nav-docs-section"><h3>使用指南</h3><ul><li><a style="margin-left:10px;" class="" href="/docs/guide-configuration.html#content">profile 配置</a></li><li><a style="margin-left:10px;" class="" href="/docs/guide-router.html#content">路由</a></li><li><a style="margin-left:10px;" class="" href="/docs/guide-orm.html#content">对象关系映射</a></li><li><a style="margin-left:10px;" class="" href="/docs/guide-rest.html#content">RESTful APIs</a></li><li><a style="margin-left:10px;" class="active" href="/docs/guide-graphql.html#content">GraphQL APIs</a></li><li><a style="margin-left:10px;" class="" href="/docs/guide-test.html#content">单元测试</a></li><li><a style="margin-left:10px;" class="" href="/docs/guide-log.html#content">日志</a></li><li><a style="margin-left:10px;" class="" href="/docs/guide-es6.html#content">使用 ES6</a></li><li><a style="margin-left:10px;" class="" href="/docs/guide-jenkins.html#content">用 Jenkins 发布</a></li><li><a style="margin-left:10px;" class="" href="/docs/guide-changelog.html#content">Chanagelog</a></li></ul></div><div class="nav-docs-section"><h3>中间件</h3><ul><li><a style="margin-left:10px;" class="" href="/docs/middleware-accesslog.html#content">accessLogMiddleware</a></li><li><a style="margin-left:10px;" class="" href="/docs/middleware-bodyparser.html#content">bodyParserMiddleware</a></li><li><a style="margin-left:10px;" class="" href="/docs/middleware-cors.html#content">corsMiddleware</a></li><li><a style="margin-left:10px;" class="" href="/docs/middleware-envelope.html#content">envelopeMiddleware</a></li><li><a style="margin-left:10px;" class="" href="/docs/middleware-graphql.html#content">graphqlMiddleware</a></li><li><a style="margin-left:10px;" class="" href="/docs/middleware-prettyjson.html#content">prettyJsonMiddleware</a></li><li><a style="margin-left:10px;" class="" href="/docs/middleware-serve.html#content">serveMiddleware</a></li></ul></div><div class="nav-docs-section"><h3>util方法</h3><ul><li><a style="margin-left:10px;" class="" href="/docs/util-pug.html#content">pug</a></li><li><a style="margin-left:10px;" class="" href="/docs/util-session.html#content">session</a></li><li><a style="margin-left:10px;" class="" href="/docs/util-requireAllRouters.html#content">requireAllRouters</a></li><li><a style="margin-left:10px;" class="" href="/docs/util-watcher.html#content">watcher</a></li></ul></div><div class="nav-docs-section"><h3>示例代码</h3><ul><li><a style="margin-left:10px;" class="" href="/docs/example-helloworld.html#content">Hello World</a></li><li><a style="margin-left:10px;" class="" href="/docs/example-commonprofile.html#content">Common Profile</a></li><li><a style="margin-left:10px;" class="" href="/docs/example-buildinsmiddlewares.html#content">Buildins Middlewares</a></li><li><a style="margin-left:10px;" class="" href="/docs/example-mixedmiddlewares.html#content">Mixed Middlewares</a></li><li><a style="margin-left:10px;" class="" href="/docs/example-rest.html#content">RESTful APIs</a></li><li><a style="margin-left:10px;" class="" href="/docs/example-graphql.html#content">GraphQL APIs</a></li></ul></div></div></div><div class="inner-content"><a id="content"></a><h1>GraphQL APIs</h1><div><p>Qails 中包含两部分和 GraphQL 相关的内容：</p><ul><li>GraphQL 中间件</li><li>GraphQL 数据操作函数</li></ul><h2><a class="anchor" name="graphql"></a>GraphQL 中间件 <a class="hash-link" href="#graphql">#</a></h2><p>参考<a href="/docs/mw-graphql.html" target="">GraphQL 中间件</a></p><h2><a class="anchor" name="graphql"></a>GraphQL 数据操作函数 <a class="hash-link" href="#graphql">#</a></h2><p>一系列操作数据库的通用函数。</p><h3><a class="anchor" name=""></a>用法 <a class="hash-link" href="#">#</a></h3><pre class="prism language-javascript">
import <span class="token punctuation">{</span> fetchList<span class="token punctuation">,</span> fetchItem<span class="token punctuation">,</span> create<span class="token punctuation">,</span> update<span class="token punctuation">,</span> destroy <span class="token punctuation">}</span> from <span class="token string">&#x27;qails&#x27;</span><span class="token punctuation">;</span>
import User from <span class="token string">&#x27;./model&#x27;</span><span class="token punctuation">;</span>
import Post from <span class="token string">&#x27;../post/model&#x27;</span><span class="token punctuation">;</span>

export default <span class="token punctuation">{</span>
  User<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    async <span class="token function">posts<span class="token punctuation">(</span></span>parent<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      args <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>args<span class="token punctuation">,</span> where<span class="token punctuation">:</span> <span class="token punctuation">{</span> user_id<span class="token punctuation">:</span> parent<span class="token punctuation">.</span>id <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> await <span class="token function">fetchList<span class="token punctuation">(</span></span>Post<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  Query<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    users<span class="token punctuation">:</span> async <span class="token punctuation">(</span>_<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> await <span class="token function">fetchList<span class="token punctuation">(</span></span>User<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    user<span class="token punctuation">:</span> async <span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>args <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> await <span class="token function">fetchItem<span class="token punctuation">(</span></span>User<span class="token punctuation">,</span> id<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  Mutation<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    createUser<span class="token punctuation">:</span> async <span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">{</span> input <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> await <span class="token function">create<span class="token punctuation">(</span></span>User<span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    updateUser<span class="token punctuation">:</span> async <span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">,</span> input <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> await <span class="token function">update<span class="token punctuation">(</span></span>User<span class="token punctuation">,</span> id<span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    deleteUser<span class="token punctuation">:</span> async <span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> await <span class="token function">destroy<span class="token punctuation">(</span></span>User<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><h3><a class="anchor" name="fetchlist-model-query"></a>fetchList(model, query) <a class="hash-link" href="#fetchlist-model-query">#</a></h3><p>获取列表，可以使用 <code>page&amp;pageSize</code> 或者 <code>offset&amp;limit</code> 来控制分页。</p><h4><a class="anchor" name=""></a>参数 <a class="hash-link" href="#">#</a></h4><ul><li>model {Model} 模型类</li><li>query<ul><li>query.withRelated {string} 获取关联数据，多个用逗号隔开</li><li>query.where {string} 查询条件，多个条件有逗号隔开，3个一组 <code>where=id,&gt;,10,name,like,%abc%</code></li><li>query.andWhere {string} and查询条件，用法同 <code>where</code></li><li>query.orWhere {string} or查询条件，用法同 <code>where</code></li><li>query.sort {string} 排序，默认正序，减号开头表示倒序，多个用逗号隔开</li><li>query.page {int} 当前页码</li><li>query.pageSize {int} 每页记录数，和 <code>page</code> 成为一组分页控制参数</li><li>query.limit {int} 控制返回记录数量</li><li>query.first {int} 同 <code>limit</code></li><li>query.offset {int} 记录偏移量，和 <code>limit</code> 成为一组分页控制参数</li><li>query.mask {string} 只返回mask列出的字段</li></ul></li></ul><h4><a class="anchor" name=""></a>返回 <a class="hash-link" href="#">#</a></h4><p>返回结果会包含两部分内容：</p><ul><li><code>pagination</code> 分页信息，当使用 <code>page&amp;pageSize</code> 分页方式时，<code>page</code> <code>pageSize</code> 才会有返回值，否则返回 <code>undefined</code>，<code>offset&amp;limit</code> 同理。<ul><li><code>rowCount</code>：{int} 记录总数</li><li><code>pageCount</code>：{int} 页面总数</li><li><code>page</code>：{int|undefined} 当前页码</li><li><code>pageSize</code>：{int|undefined} 每页显示的记录数量</li><li><code>offset</code>：{int|undefined} 获取记录的起始位置</li><li><code>limit</code>：{int|undefined} 返回的记录数</li></ul></li><li><code>list</code> {array} 模型数据</li></ul><pre class="prism language-javascript">
<span class="token punctuation">{</span>
  users <span class="token punctuation">{</span>
    pagination <span class="token punctuation">{</span>
      rowCount
      pageCount
      page
      pageSize
      offset
      limit
    <span class="token punctuation">}</span>
    list <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
         <span class="token comment" spellcheck="true"> // id
</span>         <span class="token comment" spellcheck="true"> // ...
</span>        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><p>无结果时返回 <code>EmptyResponse</code> 错误信息</p><pre class="prism language-javascript">
<span class="token punctuation">{</span>
  <span class="token string">&quot;errors&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;EmptyResponse&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;users&quot;</span><span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><h3><a class="anchor" name="fetchitem-model-id-query"></a>fetchItem(model, id, query) <a class="hash-link" href="#fetchitem-model-id-query">#</a></h3><p>获取一个对象模型。</p><h4><a class="anchor" name=""></a>参数 <a class="hash-link" href="#">#</a></h4><ul><li>model {Model} 模型类</li><li>id {int} 模型id</li><li>query<ul><li>query.withRelated {string} 获取关联数据，多个用逗号隔开</li><li>query.mask {string} 只返回mask列出的字段</li></ul></li></ul><h4><a class="anchor" name=""></a>返回 <a class="hash-link" href="#">#</a></h4><p>返回结果匹配的对象模型数据。</p><pre class="prism language-javascript">
<span class="token punctuation">{</span>
 <span class="token comment" spellcheck="true"> // id
</span><span class="token punctuation">}</span></pre><p>无结果时返回 <code>EmptyResponse</code> 错误信息</p><pre class="prism language-javascript">
<span class="token punctuation">{</span>
  <span class="token string">&quot;errors&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;EmptyResponse&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;user&quot;</span><span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><h3><a class="anchor" name="create-model-attributes"></a>create(model, attributes) <a class="hash-link" href="#create-model-attributes">#</a></h3><p>增加一个对象模型。</p><h4><a class="anchor" name=""></a>参数 <a class="hash-link" href="#">#</a></h4><ul><li>model {Model} 模型类</li><li>attributes {object} 模型数据</li></ul><h4><a class="anchor" name=""></a>返回 <a class="hash-link" href="#">#</a></h4><p>返回新增的模型数据。</p><pre class="prism language-javascript">
<span class="token punctuation">{</span>
 <span class="token comment" spellcheck="true"> // id
</span><span class="token punctuation">}</span></pre><h3><a class="anchor" name="update-model-id-attributes"></a>update(model, id, attributes) <a class="hash-link" href="#update-model-id-attributes">#</a></h3><p>修改一个对象模型。</p><h4><a class="anchor" name=""></a>参数 <a class="hash-link" href="#">#</a></h4><ul><li>model {Model} 模型类</li><li>id {int} 模型id</li><li>attributes {object} 模型数据</li></ul><h4><a class="anchor" name=""></a>返回 <a class="hash-link" href="#">#</a></h4><p>返回修改后的模型数据</p><pre class="prism language-javascript">
<span class="token punctuation">{</span>
 <span class="token comment" spellcheck="true"> // id
</span><span class="token punctuation">}</span></pre><p>当修改的模型不存在时，返回 <code>No Rows Updated</code> 错误信息</p><pre class="prism language-javascript">
<span class="token punctuation">{</span>
  <span class="token string">&quot;errors&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;No Rows Updated&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;updateUser&quot;</span><span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><h3><a class="anchor" name="destroy-model-id"></a>destroy(model, id) <a class="hash-link" href="#destroy-model-id">#</a></h3><p>删除一个对象模型。</p><h4><a class="anchor" name=""></a>参数 <a class="hash-link" href="#">#</a></h4><ul><li>model {Model} 模型类</li><li>id {int} 模型id</li></ul><h4><a class="anchor" name=""></a>返回 <a class="hash-link" href="#">#</a></h4><p>返回被删除的模型数据。</p><pre class="prism language-javascript">
<span class="token punctuation">{</span>
 <span class="token comment" spellcheck="true"> // id
</span><span class="token punctuation">}</span></pre><p>当删除的模型不存在时，返回 <code>EmptyResponse</code> 错误信息</p><pre class="prism language-javascript">
<span class="token punctuation">{</span>
  <span class="token string">&quot;errors&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;message&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;EmptyResponse&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;deleteUser&quot;</span><span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><h2><a class="anchor" name=""></a>例子 <a class="hash-link" href="#">#</a></h2><p>查考 <a href="https://github.com/qails/qails/tree/master/examples/graphql" target="_blank">GraphQL例子</a></p></div><div class="docs-prevnext"><a class="docs-next" href="guide-test.html#content">Next →</a></div><p class="edit-page-block">如果你发现文档存在错误，请<a target="_blank" href="https://github.com/qails/qails/issues">在 GitHub 提个 issue</a> 告诉我们。</p></div></section><footer class="nav-footer"><a href="https://qails.github.io" target="_blank" class="fbOpenSource"><img src="/images/qails-logo-white.png" alt="qails" width="45" height="45"></a><section class="copyright">Copyright © 2018 Qails Team.</section></footer></div><div id="fb-root"></div><script src="/js/scripts.js"></script></body></html>