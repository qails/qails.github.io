<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>SelectionState | qails</title><meta name="viewport" content="width=device-width"><link rel="stylesheet" href="/css/qails.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.34.4/es6-shim.min.js"></script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/">qails</a><ul class="nav-site"><li><a href="/docs/overview.html#content" class="active">文档</a></li><li><a href="https://github.com/qailsjs/qails" class="">github</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Quick Start</h3><ul><li><a style="margin-left:0;" class="" href="/docs/overview.html#content">Overview</a></li><li><a style="margin-left:0;" class="" href="/docs/quickstart-api-basics.html#content">API Basics</a></li><li><a style="margin-left:0;" class="" href="/docs/quickstart-rich-styling.html#content">Rich Styling</a></li></ul></div><div class="nav-docs-section"><h3>Advanced Topics</h3><ul><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-entities.html#content">Entities</a></li><li><a style="margin-left:0;" class="" href="/docs/v0-10-api-migration.html#content">v0.10 API Migration</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-decorators.html#content">Decorators</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-key-bindings.html#content">Key Bindings</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-managing-focus.html#content">Managing Focus</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-block-styling.html#content">Block Styling</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-custom-block-render-map.html#content">Custom Block Rendering</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-block-components.html#content">Custom Block Components</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-inline-styles.html#content">Complex Inline Styles</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-nested-lists.html#content">Nested Lists</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-text-direction.html#content">Text Direction</a></li><li><a style="margin-left:0;" class="" href="/docs/advanced-topics-issues-and-pitfalls.html#content">Issues and Pitfalls</a></li></ul></div><div class="nav-docs-section"><h3>API Reference</h3><ul><li><a style="margin-left:0;" class="" href="/docs/api-reference-editor.html#content">Editor Component</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-editor-change-type.html#content">EditorChangeType</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-editor-state.html#content">EditorState</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-content-state.html#content">ContentState</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-content-block.html#content">ContentBlock</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-character-metadata.html#content">CharacterMetadata</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-entity.html#content">Entity</a></li><li><a style="margin-left:0;" class="active" href="/docs/api-reference-selection-state.html#content">SelectionState</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-composite-decorator.html#content">CompositeDecorator</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-data-conversion.html#content">Data Conversion</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-rich-utils.html#content">RichUtils</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-atomic-block-utils.html#content">AtomicBlockUtils</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-key-binding-util.html#content">KeyBindingUtil</a></li><li><a style="margin-left:0;" class="" href="/docs/api-reference-modifier.html#content">Modifier</a></li></ul></div></div><div class="inner-content"><a id="content"></a><h1>SelectionState</h1><div><p><code>SelectionState</code> is an Immutable
<a href="http://facebook.github.io/immutable-js/docs/#/Record/Record" target="_blank">Record</a> that
represents a selection range in the editor.</p><p>The most common use for the <code>SelectionState</code> object is via <code>EditorState.getSelection()</code>,
which provides the <code>SelectionState</code> currently being rendered in the editor.</p><h3><a class="anchor" name="keys-and-offsets"></a>Keys and Offsets <a class="hash-link" href="#keys-and-offsets">#</a></h3><p>A selection range has two points: an <strong>anchor</strong> and a <strong>focus</strong>. (Read more on
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Selection#Glossary" target="_blank">MDN</a>).</p><p>The native DOM approach represents each point as a Node/offset pair, where the offset
is a number corresponding either to a position within a Node&#x27;s <code>childNodes</code> or, if the
Node is a text node, a character offset within the text contents.</p><p>Since Draft maintains the contents of the editor using <code>ContentBlock</code> objects,
we can use our own model to represent these points. Thus, selection points are
tracked as key/offset pairs, where the <code>key</code> value is the key of the <code>ContentBlock</code>
where the point is positioned and the <code>offset</code> value is the character offset
within the block.</p><h3><a class="anchor" name="start-end-vs-anchor-focus"></a>Start/End vs. Anchor/Focus <a class="hash-link" href="#start-end-vs-anchor-focus">#</a></h3><p>The concept of <strong>anchor</strong> and <strong>focus</strong> is very useful when actually rendering
a selection state in the browser, as it allows us to use forward and backward
selection as needed. For editing operations, however, the direction of the selection
doesn&#x27;t matter. In this case, it is more appropriate to think in terms of
<strong>start</strong> and <strong>end</strong> points.</p><p>The <code>SelectionState</code> therefore exposes both anchor/focus values and
start/end values. When managing selection behavior, we recommend that
you work with <em>anchor</em> and <em>focus</em> values to maintain selection direction.
When managing content operations, however, we recommend that you use <em>start</em>
and <em>end</em> values.</p><p>For instance, when extracting a slice of text from a block based on a
<code>SelectionState</code>, it is irrelevant whether the selection is backward:</p><pre class="prism language-javascript">
<span class="token keyword">var</span> selectionState <span class="token operator">=</span> editorState<span class="token punctuation">.</span><span class="token function">getSelection<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> anchorKey <span class="token operator">=</span> selectionState<span class="token punctuation">.</span><span class="token function">getAnchorKey<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> currentContent <span class="token operator">=</span> editorState<span class="token punctuation">.</span><span class="token function">getCurrentContent<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> currentContentBlock <span class="token operator">=</span> currentContent<span class="token punctuation">.</span><span class="token function">getBlockForKey<span class="token punctuation">(</span></span>anchorKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> start <span class="token operator">=</span> selectionState<span class="token punctuation">.</span><span class="token function">getStartOffset<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> end <span class="token operator">=</span> selectionState<span class="token punctuation">.</span><span class="token function">getEndOffset<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> selectedText <span class="token operator">=</span> currentContentBlock<span class="token punctuation">.</span><span class="token function">getText<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice<span class="token punctuation">(</span></span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>Note that <code>SelectionState</code> itself tracks only <em>anchor</em> and <em>focus</em> values.
<em>Start</em> and <em>end</em> values are derived.</p><h2><a class="anchor" name="overview"></a>Overview <a class="hash-link" href="#overview">#</a></h2><p><em>Static Methods</em></p><div><ul class="apiIndex">
  <li>
    <a href="#createempty">
      <pre>static createEmpty(blockKey)</pre>
    </a>
  </li>
</ul>

</div><p><em>Methods</em></p><div><ul class="apiIndex">
  <li>
    <a href="#getstartkey">
      <pre>getStartKey()</pre>
    </a>
  </li>
  <li>
    <a href="#getstartoffset">
      <pre>getStartOffset()</pre>
    </a>
  </li>
  <li>
    <a href="#getendkey">
      <pre>getEndKey()</pre>
    </a>
  </li>
  <li>
    <a href="#getendoffset">
      <pre>getEndOffset()</pre>
    </a>
  </li>
  <li>
    <a href="#getanchorkey">
      <pre>getAnchorKey()</pre>
    </a>
  </li>
  <li>
    <a href="#getanchoroffset">
      <pre>getAnchorOffset()</pre>
    </a>
  </li>
  <li>
    <a href="#getfocuskey">
      <pre>getFocusKey()</pre>
    </a>
  </li>
  <li>
    <a href="#getfocusoffset">
      <pre>getFocusOffset()</pre>
    </a>
  </li>
  <li>
    <a href="#getisbackward">
      <pre>getIsBackward()</pre>
    </a>
  </li>
  <li>
    <a href="#gethasfocus">
      <pre>getHasFocus()</pre>
    </a>
  </li>
  <li>
    <a href="#iscollapsed">
      <pre>isCollapsed()</pre>
    </a>
  </li>
  <li>
    <a href="#hasedgewithin">
      <pre>hasEdgeWithin(blockKey, start, end)</pre>
    </a>
  </li>
  <li>
    <a href="#serialize">
      <pre>serialize()</pre>
    </a>
  </li>
</ul>

</div><p><em>Properties</em></p><blockquote><p>Use <a href="http://facebook.github.io/immutable-js/docs/#/Record/Record" target="_blank">Immutable Map API</a> to
set properties.</p></blockquote><div><ul class="apiIndex">
  <li>
    <a href="#anchorkey">
      <pre>anchorKey</pre>
    </a>
  </li>
  <li>
    <a href="#anchoroffset">
      <pre>anchorOffset</pre>
    </a>
  </li>
  <li>
    <a href="#focuskey">
      <pre>focusKey</pre>
    </a>
  </li>
  <li>
    <a href="#focusoffset">
      <pre>focusOffset</pre>
    </a>
  </li>
  <li>
    <a href="#isbackward">
      <pre>isBackward</pre>
    </a>
  </li>
  <li>
    <a href="#hasfocus">
      <pre>hasFocus</pre>
    </a>
  </li>
</ul>

</div><h2><a class="anchor" name="static-methods"></a>Static Methods <a class="hash-link" href="#static-methods">#</a></h2><h3><a class="anchor" name="createempty"></a>createEmpty() <a class="hash-link" href="#createempty">#</a></h3><pre class="prism language-javascript">
<span class="token function">createEmpty<span class="token punctuation">(</span></span>blockKey<span class="token punctuation">:</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span> SelectionState</pre><p>Create a <code>SelectionState</code> object at the zero offset of the provided block key
and <code>hasFocus</code> set to false.</p><h2><a class="anchor" name="methods"></a>Methods <a class="hash-link" href="#methods">#</a></h2><h3><a class="anchor" name="getstartkey"></a>getStartKey() <a class="hash-link" href="#getstartkey">#</a></h3><pre class="prism language-javascript">
<span class="token function">getStartKey<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> string</pre><p>Returns the key of the block containing the start position of the selection range.</p><h3><a class="anchor" name="getstartoffset"></a>getStartOffset() <a class="hash-link" href="#getstartoffset">#</a></h3><pre class="prism language-javascript">
<span class="token function">getStartOffset<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> number</pre><p>Returns the block-level character offset of the start position of the selection range.</p><h3><a class="anchor" name="getendkey"></a>getEndKey() <a class="hash-link" href="#getendkey">#</a></h3><pre class="prism language-javascript">
<span class="token function">getEndKey<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> string</pre><p>Returns the key of the block containing the end position of the selection range.</p><h3><a class="anchor" name="getendoffset"></a>getEndOffset() <a class="hash-link" href="#getendoffset">#</a></h3><pre class="prism language-javascript">
<span class="token function">getEndOffset<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> number</pre><p>Returns the block-level character offset of the end position of the selection range.</p><h3><a class="anchor" name="getanchorkey"></a>getAnchorKey() <a class="hash-link" href="#getanchorkey">#</a></h3><pre class="prism language-javascript">
<span class="token function">getAnchorKey<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> string</pre><p>Returns the key of the block containing the anchor position of the selection range.</p><h3><a class="anchor" name="getanchoroffset"></a>getAnchorOffset() <a class="hash-link" href="#getanchoroffset">#</a></h3><pre class="prism language-javascript">
<span class="token function">getAnchorOffset<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> number</pre><p>Returns the block-level character offset of the anchor position of the selection range.</p><h3><a class="anchor" name="getfocuskey"></a>getFocusKey() <a class="hash-link" href="#getfocuskey">#</a></h3><pre class="prism language-javascript">
<span class="token function">getFocusKey<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> string</pre><p>Returns the key of the block containing the focus position of the selection range.</p><h3><a class="anchor" name="getfocusoffset"></a>getFocusOffset() <a class="hash-link" href="#getfocusoffset">#</a></h3><pre class="prism language-javascript">
<span class="token function">getFocusOffset<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> number</pre><p>Returns the block-level character offset of the focus position of the selection range.</p><h3><a class="anchor" name="getisbackward"></a>getIsBackward() <a class="hash-link" href="#getisbackward">#</a></h3><pre class="prism language-javascript">
<span class="token function">getIsBackward<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> boolean</pre><p>Returns whether the focus position is before the anchor position in the document.</p><p>This must be derived from the key order of the active <code>ContentState</code>, or if the selection
range is entirely within one block, a comparison of the anchor and focus offset values.</p><h3><a class="anchor" name="gethasfocus"></a>getHasFocus() <a class="hash-link" href="#gethasfocus">#</a></h3><pre class="prism language-javascript">
<span class="token function">getHasFocus<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> boolean</pre><p>Returns whether the editor has focus.</p><h3><a class="anchor" name="iscollapsed"></a>isCollapsed() <a class="hash-link" href="#iscollapsed">#</a></h3><pre class="prism language-javascript">
<span class="token function">isCollapsed<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> boolean</pre><p>Returns whether the selection range is collapsed, i.e. a caret. This is true
when the anchor and focus keys are the same /and/ the anchor and focus offsets
are the same.</p><h3><a class="anchor" name="hasedgewithin"></a>hasEdgeWithin() <a class="hash-link" href="#hasedgewithin">#</a></h3><pre class="prism language-javascript">
<span class="token function">hasEdgeWithin<span class="token punctuation">(</span></span>blockKey<span class="token punctuation">:</span> string<span class="token punctuation">,</span> start<span class="token punctuation">:</span> number<span class="token punctuation">,</span> end<span class="token punctuation">:</span> number<span class="token punctuation">)</span><span class="token punctuation">:</span> boolean</pre><p>Returns whether the selection range has an edge that overlaps with the specified
start/end range within a given block.</p><p>This is useful when setting DOM selection within a block after contents are
rendered.</p><h3><a class="anchor" name="serialize"></a>serialize() <a class="hash-link" href="#serialize">#</a></h3><pre class="prism language-javascript">
<span class="token function">serialize<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> string</pre><p>Returns a serialized version of the <code>SelectionState</code>. Useful for debugging.</p><h2><a class="anchor" name="properties"></a>Properties <a class="hash-link" href="#properties">#</a></h2><blockquote><p>Use <a href="http://facebook.github.io/immutable-js/docs/#/Record/Record" target="_blank">Immutable Map API</a> to
set properties.</p></blockquote><pre class="prism language-javascript">
<span class="token keyword">var</span> selectionState <span class="token operator">=</span> SelectionState<span class="token punctuation">.</span><span class="token function">createEmpty<span class="token punctuation">(</span></span><span class="token string">&#x27;foo&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> updatedSelection <span class="token operator">=</span> selectionState<span class="token punctuation">.</span><span class="token function">merge<span class="token punctuation">(</span></span><span class="token punctuation">{</span>
  focusKey<span class="token punctuation">:</span> <span class="token string">&#x27;bar&#x27;</span><span class="token punctuation">,</span>
  focusOffset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> anchorKey <span class="token operator">=</span> updatedSelection<span class="token punctuation">.</span><span class="token function">getAnchorKey<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // &#x27;foo&#x27;
</span><span class="token keyword">var</span> focusKey <span class="token operator">=</span> updatedSelection<span class="token punctuation">.</span><span class="token function">getFocusKey<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true"> // &#x27;bar&#x27;</span></pre><h3><a class="anchor" name="anchorkey"></a>anchorKey <a class="hash-link" href="#anchorkey">#</a></h3><p>The block containing the anchor end of the selection range.</p><h3><a class="anchor" name="anchoroffset"></a>anchorOffset <a class="hash-link" href="#anchoroffset">#</a></h3><p>The offset position of the anchor end of the selection range.</p><h3><a class="anchor" name="focuskey"></a>focusKey <a class="hash-link" href="#focuskey">#</a></h3><p>The block containing the focus end of the selection range.</p><h3><a class="anchor" name="focusoffset"></a>focusOffset <a class="hash-link" href="#focusoffset">#</a></h3><p>The offset position of the focus end of the selection range.</p><h3><a class="anchor" name="isbackward"></a>isBackward <a class="hash-link" href="#isbackward">#</a></h3><p>If the anchor position is lower in the document than the focus position, the
selection is backward. Note: The <code>SelectionState</code> is an object with
no knowledge of the <code>ContentState</code> structure. Therefore, when updating
<code>SelectionState</code> values, you are responsible for updating <code>isBackward</code> as well.</p><h3><a class="anchor" name="hasfocus"></a>hasFocus <a class="hash-link" href="#hasfocus">#</a></h3><p>Whether the editor currently has focus.</p></div><div class="docs-prevnext"><a class="docs-next" href="api-reference-composite-decorator.html#content">Next →</a></div></div></section><footer class="wrap"><div class="right">© 2017</div></footer></div><div id="fb-root"></div></body></html>